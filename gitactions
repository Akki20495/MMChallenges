# Create a folder under the drive root
mkdir actions-runner
cd actions-runner

# Download the latest runner package
Invoke-WebRequest -Uri https://github.com/actions/runner/releases/download/v2.316.1/actions-runner-win-x64-2.316.1.zip -OutFile actions-runner-win-x64-2.316.1.zip

# Optional: Validate the hash
if ((Get-FileHash -Path actions-runner-win-x64-2.316.1.zip -Algorithm SHA256).Hash.ToUpper() -ne 'e41debe4f0a83f66b28993ef84dad944c8c82e2c9da81f56a850bc27fedd76b'.ToUpper()) {
    throw "Computed checksum did not match"
}

# Extract the installer
Add-Type -AssemblyName System.IO.Compression.FileSystem
[System.IO.Compression.ZipFile]::ExtractToDirectory("$PWD/actions-runner-win-x64-2.316.1.zip", "$PWD")

# Configure
# Create the runner and start the configuration experience
./config.cmd --url https://github.com/massmutual/NBU_EZApp --token AYMMYTYVONPJTHLBAT6UYUDGMALIW